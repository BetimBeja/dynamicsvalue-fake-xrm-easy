
# FakeXrmEasy: The Test Automation Framework for the Power Platform / Dataverse

## Why should my company use FakeXrmEasy? 
--------------------------------------------------

FakeXrmEasy is trusted by giants and loved by developers. With more than 1.4M downloads of version 1, accounts for more than 20% of all the CRM SDK packages downloads, worlwide. 

We conducted a pretty extensive research study over several months to measure the impact that FakeXrmEasy had on the development lifecycle of more than 30 different organisations.

The research showed:

-  Average of 191% increased ProDev efficiency due to the reduction of escaped defects
-  Average of 33% increased ProDev efficiency due to other time savings

You can find more details about the study [here: TODO add link](https://todo).

## Packages
----------------------------------------------------------------
FakeXrmEasy version 2 or later is broken down into several repositories / packages below:


|Repo/Package|Build|Quality Gate|Coverage|Security|Maintainability|Reliability|
|------------|-----| ---------- | ------ | ------ | ------------- | --------- |
|[FakeXrmEasy.Abstractions](https://github.com/DynamicsValue/fake-xrm-easy-abstractions)|![Build](https://github.com/DynamicsValue/fake-xrm-easy-abstractions/workflows/CI/badge.svg)|[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-abstractions&metric=alert_status&token=ecafcd1ed73f047af28e3cbdd3375fe1a789814c)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-abstractions)|[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-abstractions&metric=coverage&token=ecafcd1ed73f047af28e3cbdd3375fe1a789814c)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-abstractions)|[![Security Rating](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-abstractions&metric=security_rating&token=ecafcd1ed73f047af28e3cbdd3375fe1a789814c)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-abstractions)|[![Maintainability Rating](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-abstractions&metric=sqale_rating&token=ecafcd1ed73f047af28e3cbdd3375fe1a789814c)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-abstractions)|[![Reliability Rating](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-abstractions&metric=reliability_rating&token=ecafcd1ed73f047af28e3cbdd3375fe1a789814c)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-abstractions)|
|[FakeXrmEasy.Core](https://github.com/DynamicsValue/fake-xrm-easy-core)|![Build](https://github.com/DynamicsValue/fake-xrm-easy-core/workflows/CI/badge.svg)|[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-core&metric=alert_status&token=275c67c8b62adac17e4e9a0ae210c77703d671d1)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-core)|[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-core&metric=coverage&token=275c67c8b62adac17e4e9a0ae210c77703d671d1)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-core)|[![Security Rating](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-core&metric=security_rating&token=275c67c8b62adac17e4e9a0ae210c77703d671d1)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-core)|[![Maintainability Rating](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-core&metric=sqale_rating&token=275c67c8b62adac17e4e9a0ae210c77703d671d1)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-core)|[![Reliability Rating](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-core&metric=reliability_rating&token=275c67c8b62adac17e4e9a0ae210c77703d671d1)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-core)|
|[FakeXrmEasy.Plugins](https://github.com/DynamicsValue/fake-xrm-easy-plugins)|![Build](https://github.com/DynamicsValue/fake-xrm-easy-plugins/workflows/CI/badge.svg)|[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-plugins&metric=alert_status&token=97ba86baecacf2c2d8a4a398749c54c4bd3b0260)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-plugins)|[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-plugins&metric=coverage&token=97ba86baecacf2c2d8a4a398749c54c4bd3b0260)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-plugins)|[![Security Rating](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-plugins&metric=security_rating&token=97ba86baecacf2c2d8a4a398749c54c4bd3b0260)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-plugins)|[![Maintainability Rating](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-plugins&metric=sqale_rating&token=97ba86baecacf2c2d8a4a398749c54c4bd3b0260)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-plugins)|[![Reliability Rating](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-plugins&metric=reliability_rating&token=97ba86baecacf2c2d8a4a398749c54c4bd3b0260)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-plugins)|
|[FakeXrmEasy.CodeActivities](https://github.com/DynamicsValue/fake-xrm-easy-plugins)|![Build](https://github.com/DynamicsValue/fake-xrm-easy-code-activities/workflows/CI/badge.svg)|[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-code-activities&metric=alert_status&token=58def40fea2d6e0b001eff7d52dce7073ca778ca)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-code-activities)|[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-code-activities&metric=coverage&token=58def40fea2d6e0b001eff7d52dce7073ca778ca)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-code-activities)|[![Security Rating](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-code-activities&metric=security_rating&token=58def40fea2d6e0b001eff7d52dce7073ca778ca)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-code-activities)|[![Maintainability Rating](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-code-activities&metric=sqale_rating&token=58def40fea2d6e0b001eff7d52dce7073ca778ca)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-code-activities)|[![Reliability Rating](https://sonarcloud.io/api/project_badges/measure?project=DynamicsValue_fake-xrm-easy-code-activities&metric=reliability_rating&token=58def40fea2d6e0b001eff7d52dce7073ca778ca)](https://sonarcloud.io/dashboard?id=DynamicsValue_fake-xrm-easy-code-activities)|

## Installing
-----------------------------------------------

Which package do I need to install? 

One of the reasons to separate the original package in v1.x into smaller ones in v2.x was the single responsibility principle. For example, when doing unit testing of plugins, you don't really the integration package. Similarly, when unit testing Azure Functions you don't probably need plugin testing helpers at all.

This architecture also supports adding optional extension packages depending on your needs (i.e. package for Security testing).

These are some general guidelines about the intended usage. This list will be updated over time to accomodate new packages.


|Package|Use examples|
|-------|------------|
|FakeXrmEasy.Plugins|This package contains helpers to make it easy to unit test plugins (or the interactions between these plugins pipeline simulation -TBC-)|
|FakeXrmEasy.CodeActivities|This package contains helpers to make it easy to unit test code activities|
|FakeXrmEasy.Core| This is the core package, and will be needed across pretty much all uses and autmatically installed as a package dependency when you install any of the others|
|FakeXrmEasy|This is an include package, it references pretty much all the other packages and is meant to be used a tool to ease migration from v1.x|




## What's New in 2.x?
-------------------------------------------------

  - Support for .net core 3.1. / Full .NET framework support with multi-targeting   
  - Single original repo broken down into smaller, more extensible and easier to maintain repos
  - New semantinc versioning using prerelease suffixes [SemVer 2.0.0](https://docs.microsoft.com/en-us/nuget/concepts/package-versioning#semantic-versioning-200) 
  - Original FAKE build script has been redeveloped in Powershell Core for building both locally (build-local-push.ps1) and form GitHub actions, cross platform. 
  - Added SonarCloud quality gate
  - Now using GitHub Actions as opposed to AppVeyor previously in 1.x.
  - ** New Middleware!!! ** => effectivley rewritten the core implementation (based on aspnetcore middleware)
  - New GetProperty / SetProperty to allow to dynamically extend context properties
  - Massive refactoring

  ## Breaking changes summary from 1.x -> 2.x

  - The major updates is that, since the release of Powerplatform.Cds.Client nuget package, we broke the original package into several smaller ones:

      - FakeXrmEasy.Abstractions  (base package with abstractions - interfaces, poco, enums, etc)
      - FakeXrmEasy.Core  ( the core of the framework, middleware, crud, query translation)
      - FakeXrmEasy.Plugins
      - FakeXrmEasy.Pipeline  (pipeline simulation behaviors, test interaction between plugins and react to messages)
      - FakeXrmEasy.CodeActivities
      - FakeXrmEasy.Messages.Cds   (CDS specific messages, this matches the separation introduced by MS)
      - FakeXrmEasy.Messages.Dynamics (Dynamics specific messages, again, matches separation by MS)
      - FakeXrmEasy (package with a default)
      - FakeXrmEasy.Integration  (XrmRealContext moved to this separate package)

 - XrmFakedContext constructor is deprecated => use IXrmFakedContext interface directly and encouraging to use a factory method instead. The factory method can be used to put the middleware initialisation in the one place, to be easily maintained and reused across unit tests.

  - Introduced PluginContextProperties: some methods to retrieve properties related to plugin context that were previously accessible from the XrmFakedContext class (GetFakedTracingService, GetServiceEndpointNotificationService, etc), have been refactored and moved into a new PluginContextProperties class / interface, available in the FakeXrmEasy.Plugins package (fake-xrm-easy-plugins repo)
  
  - New Middleware! Previously one could introduce any custom messages that would react to specific requests. This implementation was 1 to 1, meaning there could up to one fake message executor to react to one specific request... 
  
  We have now rewrittten the core of FakXrmEasy to introduce a new fully configurable middleware, inspired on aspnet core, that will make each request to be executed through a confiurable pipeline, effectively allowing multiple interactions / behaviors per request, plus the ability to define the order of execution of those yourself, without having to "touch" or mantain the "core" of the framework. This will allow for much more flexibility and much less maintenance involved.

   - The middleware will allow you to extend the framework in a more flexible and easier way, while also
   giving you the ability to customize the pipeline execution order, or to extend it to cater for your own needs.

   - ProxyTypesAssembly is deprecated => use EnableProxyTypes() which allows multiple assemblies and ProxyTypesAssemblies.Count() > 0 to check if using early bound assemblies

   - FiscalYearSettings and TimeZoneInfo settings have been moved to .Abstractions and will use the new GetProperty&lt;T&gt; / SetProperty&lt;T&gt; methods

   - The enumeration in XrmFakeRelationship has been renamed to FakeRelationshipType, to meet Sonar quality rules

   - IFakeMessageExecutor interface has been moved to FakeXrmEasy.Abstractions.FakeMessageExecutors and its Execute method must receive an IXrmFakedContext as opposed to a XrmFakedContext class

   - CallerId => Moved to .CallerProperties.CallerId

   - New IStatusAttributeMetadataRepository and IOptionSetMetadataRepository

  - ValidateReferences public property has been moved to the middleware initialisation, defaulting to false while also adding the option to initialise it via .AddCrud(IIntegrityOptions)

  - DateBehaviour has been removed since it belongs to Metadata, and so it will use now DateTimeBehaviors based on the injected EntityMetadata

## Building
-------------------------------------------

TO DO

## Contributing
------------------------

This project welcomes contributions and suggestions. Most contributions require you to agree to a Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us the rights to use your contribution. For details, visit [our CLA here](https://github.com/DynamicsValue/licence-agreements/blob/main/FakeXrmEasy/CLA.md).

When you submit a pull request, a CLA-bot will automatically determine whether you need to provide a CLA and decorate the PR appropriately (e.g., label, comment). Simply follow the instructions provided by the bot. You will only need to do this once across all repos using our CLA. 


## License
-------------------

Please see [LICENSE.txt](https://github.com/DynamicsValue/fake-xrm-easy/blob/master/LICENSE.txt).

